<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>後台訂單處理系統</title>
    <link rel="stylesheet" href="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script src="https://cdn.staticfile.org/Chart.js/3.9.1/chart.js"></script>
<!--    <script>-->
<!--        $( function() {-->
<!--            $( "#sortable" ).sortable();-->
<!--        } );-->
<!--    </script>-->
    <style>
        #customers {
            font-family: Arial, Helvetica, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        #customers td, #customers th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #customers tr:nth-child(even){background-color: #f2f2f2;}

        #customers tr:hover {background-color: #93bd77;}

        #customers th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #298cbb;
            color: white;
        }
    </style>
</head>
<body>
<div class="row column text-center">
    <h2>後台訂單處理系統(未完成訂單)</h2>
    <hr>
</div>
<div id="sortable" class="row small-up-2 medium-up-3 large-up-6">
    <div th:each="receiveOrder : ${receiveOrder}" class="column">
        <h5>訂單號碼：<span th:text="${receiveOrder.getONumber()}"></span></h5>
        <p>種類：<span th:text="${receiveOrder.getType()}"></span></p>
        <p>產品：<span th:text="${receiveOrder.getProduct()}"></span></p>
        <p>加料：<span th:text="${receiveOrder.getMaterial()}"></span></p>
        <p>數量：<span th:text="${receiveOrder.getQty()}"></span></p>
        <p>冷熱飲：<span th:text="${receiveOrder.getStates()}"></span></p>
        <p>訂單時間：<span th:text="${receiveOrder.getDate()}"></span></p>
        <form action="/checkOutOrder" method="post">
            <input type="hidden" name="oNumber" th:value="${receiveOrder.getONumber()}">
            <button type="submit" class="button small expanded hollow">完成訂單</button>
        </form>
    </div>
</div>

<div class="row column text-center">
    <h2>後台訂單處理系統(訂單報表)</h2>
    <hr>
</div>

<div class="row small-up-2 medium-up-3 large-up-6">
    <canvas id="myChart" width="400" height="200"></canvas>
</div>

<div id="chartOrder">

</div>

<div id="receiveOrder">

</div>


<!--<div class="row column text-center">-->
<!--    <h2>後台訂單處理系統(全部清單)</h2>-->
<!--    <hr>-->
<!--</div>-->
<!--<div class="row small-up-2 medium-up-3 large-up-6">-->
<!--<table id="customers">-->
<!--    <tr>-->
<!--        <th>訂單號碼</th>-->
<!--        <th>種類</th>-->
<!--        <th>產品</th>-->
<!--        <th>加料</th>-->
<!--        <th>數量</th>-->
<!--        <th>冷熱飲</th>-->
<!--        <th>訂單時間</th>-->
<!--    </tr>-->
<!--    <tr th:each="receiveOrder : ${receiveOrder}">-->
<!--        <td th:text="${ receiveOrder.getONumber() }"></td>-->
<!--        <td th:text="${ receiveOrder.getType() }"></td>-->
<!--        <td th:text="${ receiveOrder.getProduct() }"></td>-->
<!--        <td th:text="${ receiveOrder.getMaterial() }"></td>-->
<!--        <td th:text="${ receiveOrder.getQty() }"></td>-->
<!--        <td th:text="${ receiveOrder.getStates() }"></td>-->
<!--        <td th:text="${ receiveOrder.getDate() }"></td>-->
<!--    </tr>-->
<!--</table>-->
<!--</div>-->
<script>
    $(document).ready(function() {
        // AjaxUpload1();
        AjaxUpload2();
        getData();

    // setInterval(AjaxUpload1,10000);
    // setInterval(AjaxUpload2, 10000);

    // function AjaxUpload1() {
    //     $('#chartOrder').load('/chartOrder')
    // }

    function AjaxUpload2() {
        $('#receiveOrder').load('/receiveOrderList')
    }

        function getData() {
            console.log("發出 Rest API 需求取得資料");
            $.get('/api/chartOrder/',function (data, status) {
                // console.log("取得資料"+JSON.stringify(data[0]));
                // console.log("轉換資料"+data[0].total);
                var totalsArray = [];
                for (var i=0; i<data.length; i++) {
                    console.log("取得資料"+data[i].total);
                    console.log( "轉換資料"+JSON.stringify(data[i].total));
                    totalsArray.push(data[i].total);
                }
                showReport(totalsArray);
            })
        }


        // var myChart= null;

        function showReport (reportData) {
            // if( myChart != null) {
            //     myChart.destroy();
            // }
            const ctx = document.getElementById('myChart');
            const labels = ['冬瓜茶系列', '原味茶', '滋味茶','芝士奶蓋', '風味茶', '香醇奶茶', '鮮奶茶'];  // 设置 X 轴上对应的标签
            const data = {
                labels: labels,
                datasets: [{
                    label: '訂單報表',
                    data: reportData,
                    backgroundColor: [      // 设置每个柱形图的背景颜色
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(255, 159, 64, 0.2)',
                        'rgba(255, 205, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(201, 203, 207, 0.2)'
                    ],
                    borderColor: [     //设置每个柱形图边框线条颜色
                        'rgb(255, 99, 132)',
                        'rgb(255, 159, 64)',
                        'rgb(255, 205, 86)',
                        'rgb(75, 192, 192)',
                        'rgb(54, 162, 235)',
                        'rgb(153, 102, 255)',
                        'rgb(201, 203, 207)'
                    ],
                    borderWidth: 1     // 设置线条宽度
                }]
            };
            const config = {
                type: 'bar', // 设置图表类型
                data: data,  // 设置数据集
                options: {
                    scales: {
                        y: {
                            beginAtZero: true // 设置 y 轴从 0 开始
                        }
                    }
                },
            };
            const myChart = new Chart(ctx, config);
        }
    });
</script>
</body>
</html>
